# 需求分析

## 模块外部激励

1. 开始信号
2. 结束信号
3. 记录触发信号

##  并发设计

1. 控制线程

   检查参数（URL、文件名，缓存时间1，缓存时间2）有效性；

   建立`FFmpeg`运行所需的上下文环境；

2. 读数据线程

3. 写数据线程

## 线程逻辑

1. 模块接受到开始信号后，读线程开始工作，开始缓存视频数据，缓存时间1到达后则开始删除最早的数据
2. 模块接收到记录触发信号后，读线程和写线程开始并发执行，读线程继续读取数据到缓存区，写线程开始从缓存区获取数据写入到记录文件，
3. 缓存时间2到后，读线程停止工作，发出读结束信号，并等待写线程将全部数据写入文件
4. 写线程收到读结束信号，等待将数据全部写入后，发出写结束信号，写线程退出执行
5. 读线程收到写结束信号重新开始执行，等待重新触发记录信号

## 结束信号处理

1. 立即停止接受读数据，关闭读线程，启动写线程，等待写数据结束；

